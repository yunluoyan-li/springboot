# 领养申请功能使用说明

## 功能概述

领养申请功能允许用户对感兴趣的宠物提交领养申请，管理员可以审核这些申请并做出通过或拒绝的决定。

## 功能特性

### 用户功能
- ✅ 浏览可领养宠物列表
- ✅ 提交领养申请
- ✅ 查看个人申请历史
- ✅ 查看申请状态和审核结果
- ✅ 防止重复申请同一宠物

### 管理员功能
- ✅ 查看所有领养申请列表
- ✅ 查看申请详情（包括申请人信息和宠物信息）
- ✅ 审核申请（通过/拒绝）
- ✅ 添加审核意见
- ✅ 删除申请记录
- ✅ 查看申请统计数据

## 数据库表结构

### adoption_applications 表
```sql
CREATE TABLE adoption_applications (
    application_id BIGINT AUTO_INCREMENT PRIMARY KEY,
    pet_id BIGINT NOT NULL,
    user_id BIGINT NOT NULL,
    application_text TEXT NOT NULL COMMENT '申请理由',
    home_description TEXT NOT NULL COMMENT '家庭环境描述',
    experience TEXT COMMENT '养宠经验',
    status VARCHAR(20) NOT NULL DEFAULT 'PENDING' COMMENT '状态',
    admin_notes TEXT COMMENT '管理员审核意见',
    response_date TIMESTAMP NULL COMMENT '审核时间',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '申请时间',
    
    FOREIGN KEY (pet_id) REFERENCES pets(pet_id),
    FOREIGN KEY (user_id) REFERENCES users(user_id),
    UNIQUE KEY uk_user_pet (user_id, pet_id)
);
```

## 页面路由

### 用户页面
- `/adoption/apply/{petId}` - 申请领养表单
- `/adoption/my-applications` - 我的申请列表

### 管理员页面
- `/adoption/list` - 所有申请列表
- `/adoption/detail/{applicationId}` - 申请详情

### API 接口
- `POST /adoption/apply` - 提交申请
- `POST /adoption/approve/{applicationId}` - 通过申请
- `POST /adoption/reject/{applicationId}` - 拒绝申请
- `GET /adoption/delete/{applicationId}` - 删除申请
- `GET /adoption/stats` - 获取统计数据

## 使用流程

### 用户申请流程
1. 用户登录系统
2. 浏览宠物列表页面 (`/pets/list`)
3. 点击感兴趣的宠物的"申请领养"按钮
4. 填写申请表单：
   - 申请理由（必填）
   - 家庭环境描述（必填）
   - 养宠经验（可选）
5. 提交申请
6. 在"我的申请"页面查看申请状态

### 管理员审核流程
1. 管理员登录系统
2. 进入"领养申请"页面 (`/adoption/list`)
3. 查看申请列表，了解申请状态
4. 点击"查看"按钮查看申请详情
5. 在详情页面进行审核操作：
   - 通过申请：填写审核意见（可选），点击"通过申请"
   - 拒绝申请：填写拒绝原因（必填），点击"拒绝申请"
6. 系统自动更新申请状态和审核时间

## 申请状态说明

- **PENDING（待审核）**：申请已提交，等待管理员审核
- **APPROVED（已通过）**：申请已通过审核，可以安排领养
- **REJECTED（已拒绝）**：申请被拒绝，用户可以看到拒绝原因

## 业务规则

1. **防重复申请**：同一用户不能对同一宠物重复申请
2. **状态限制**：只有状态为"可领养"的宠物才能申请
3. **必填信息**：申请理由和家庭环境描述为必填项
4. **审核要求**：拒绝申请时必须填写拒绝原因
5. **时间记录**：系统自动记录申请时间和审核时间

## 文件结构

```
src/main/java/com/example/petadoption/
├── controller/
│   └── AdoptionApplicationController.java    # 控制器
├── service/
│   ├── AdoptionApplicationService.java       # 服务接口
│   └── impl/
│       └── AdoptionApplicationServiceImpl.java # 服务实现
├── mapper/
│   └── AdoptionApplicationDao.java           # 数据访问接口
└── model/
    └── AdoptionApplication.java              # 实体模型

src/main/resources/
├── mapper/
│   └── AdoptionApplicationMapper.xml         # MyBatis映射文件
└── templates/adoption/
    ├── list.html                             # 申请列表页面
    ├── myApplications.html                   # 我的申请页面
    ├── apply.html                            # 申请表单页面
    └── detail.html                           # 申请详情页面
```

## 部署说明

1. **数据库准备**：
   - 执行 `adoption_applications_table.sql` 创建数据表
   - 确保 `pets` 和 `users` 表已存在

2. **应用配置**：
   - 确保 MyBatis 配置正确
   - 检查数据库连接配置

3. **权限配置**：
   - 用户需要登录才能申请
   - 管理员需要相应权限才能审核

## 测试建议

### 功能测试
1. 测试用户申请流程
2. 测试重复申请限制
3. 测试管理员审核流程
4. 测试申请状态更新
5. 测试数据统计功能

### 边界测试
1. 测试必填字段验证
2. 测试长文本输入
3. 测试并发申请
4. 测试数据删除操作

## 扩展建议

1. **邮件通知**：申请状态变更时发送邮件通知
2. **短信提醒**：重要状态变更时发送短信
3. **申请评分**：根据申请内容进行评分
4. **自动审核**：简单的申请可以自动通过
5. **申请模板**：提供申请模板供用户参考
6. **图片上传**：允许用户上传家庭环境照片

## 常见问题

### Q: 用户看不到申请按钮？
A: 检查宠物状态是否为"AVAILABLE"，用户是否已登录

### Q: 申请提交失败？
A: 检查是否已经申请过该宠物，必填字段是否完整

### Q: 审核操作失败？
A: 检查管理员权限，申请状态是否为"PENDING"

### Q: 统计数据不准确？
A: 检查数据库查询语句，确保状态值正确 