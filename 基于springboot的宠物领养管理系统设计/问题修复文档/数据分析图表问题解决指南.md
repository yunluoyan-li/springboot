# 数据分析图表问题解决指南

## 问题描述
在运行宠物领养系统项目后，点击数据分析模块发现没有图表显示。

## 可能的原因和解决方案

### 1. 数据库数据不足

**问题**: 数据库中没有足够的数据来生成图表。

**解决方案**:
1. 运行数据库初始化脚本：
   ```sql
   -- 在MySQL中执行
   source init_database.sql;
   ```

2. 插入测试数据：
   ```sql
   -- 在MySQL中执行
   source insert_test_data.sql;
   ```

3. 检查数据库状态：
   ```sql
   -- 在MySQL中执行
   source check_database.sql;
   ```

### 2. 数据库连接问题

**问题**: 应用程序无法连接到数据库。

**解决方案**:
1. 检查数据库配置 (`src/main/resources/application.properties`):
   ```properties
   spring.datasource.url=jdbc:mysql://localhost:3306/pet_adoption_db?useSSL=false&serverTimezone=UTC&characterEncoding=UTF-8
   spring.datasource.username=root
   spring.datasource.password=123456
   ```

2. 确保MySQL服务正在运行
3. 确保数据库 `pet_adoption_db` 已创建

### 3. JavaScript图表库问题

**问题**: Chart.js库没有正确加载或初始化。

**解决方案**:
1. 访问基础测试页面验证Chart.js是否工作：
   ```
   http://localhost:8080/analytics-basic
   ```

2. 如果基础测试页面显示图表，说明Chart.js正常，问题在于数据获取

### 4. 后端数据获取问题

**问题**: 后端无法正确获取数据或数据格式不正确。

**解决方案**:
1. 访问调试页面查看详细错误信息：
   ```
   http://localhost:8080/test/analytics-debug
   ```

2. 检查浏览器控制台错误信息

3. 检查应用程序日志

### 5. 前端数据传递问题

**问题**: 后端数据没有正确传递到前端。

**解决方案**:
1. 检查主数据分析页面的JavaScript代码
2. 确保数据变量正确传递
3. 检查Thymeleaf模板语法

## 诊断步骤

### 步骤1: 检查数据库
1. 连接到MySQL数据库
2. 执行检查脚本：
   ```sql
   source check_database.sql;
   ```
3. 确认各表有足够的数据

### 步骤2: 测试基础功能
1. 访问基础测试页面：
   ```
   http://localhost:8080/analytics-basic
   ```
2. 如果显示测试图表，说明Chart.js正常

### 步骤3: 检查数据获取
1. 访问调试页面：
   ```
   http://localhost:8080/test/analytics-debug
   ```
2. 查看数据获取状态和错误信息

### 步骤4: 测试API
1. 在调试页面点击"测试API"按钮
2. 查看API返回的数据格式

### 步骤5: 检查主页面
1. 访问主数据分析页面：
   ```
   http://localhost:8080/analytics
   ```
2. 打开浏览器开发者工具查看控制台错误

## 常见错误和解决方案

### 错误1: "Cannot read property 'getContext' of null"
**原因**: Canvas元素没有找到
**解决**: 检查HTML中的canvas ID是否正确

### 错误2: "Chart is not defined"
**原因**: Chart.js库没有加载
**解决**: 检查网络连接，确保Chart.js CDN可访问

### 错误3: "Data is undefined"
**原因**: 后端数据没有正确传递
**解决**: 检查后端数据获取逻辑

### 错误4: "SQL syntax error"
**原因**: 数据库查询语法错误
**解决**: 检查Mapper XML文件中的SQL语句

## 测试页面说明

### 1. 基础测试页面 (`/analytics-basic`)
- 测试Chart.js库是否正常工作
- 显示4个测试图表（饼图、柱状图、折线图、环形图）
- 如果这个页面显示图表，说明前端功能正常

### 2. 调试页面 (`/test/analytics-debug`)
- 显示详细的数据获取状态
- 显示各表的数据量
- 显示图表数据的具体内容
- 提供API测试功能

### 3. 主数据分析页面 (`/analytics`)
- 显示实际的数据分析图表
- 需要数据库中有足够的数据

## 数据要求

为了正常显示图表，数据库需要包含：

1. **用户数据**: 至少1个用户
2. **宠物数据**: 至少5个宠物，包含不同状态和性别
3. **申请数据**: 至少3个申请记录
4. **分类数据**: 至少2个宠物分类
5. **品种数据**: 至少5个宠物品种

## 联系支持

如果按照以上步骤仍然无法解决问题，请：

1. 检查应用程序日志
2. 查看浏览器控制台错误信息
3. 确认数据库连接正常
4. 验证所有测试页面是否正常工作

## 快速修复脚本

如果问题仍然存在，可以运行以下SQL脚本快速插入测试数据：

```sql
-- 在MySQL中执行
USE pet_adoption_db;
source insert_test_data.sql;
```

然后重新访问数据分析页面。 