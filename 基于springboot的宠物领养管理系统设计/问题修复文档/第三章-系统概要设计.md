# 第三章 系统概要设计

## 3.1 系统总体设计

### 3.1.1 系统架构

宠物领养系统采用分层架构设计，主要分为以下几层：

**表现层（Presentation Layer）：**
- 负责用户界面的展示和用户交互
- 采用Thymeleaf模板引擎实现动态页面
- 使用Bootstrap框架提供响应式设计
- 集成Chart.js实现数据可视化

**业务逻辑层（Business Logic Layer）：**
- 实现系统的核心业务逻辑
- 包含用户管理、宠物管理、申请管理等服务
- 提供数据验证和业务规则处理
- 实现事务管理和异常处理

**数据访问层（Data Access Layer）：**
- 负责与数据库的交互
- 使用MyBatis框架实现ORM映射
- 提供数据持久化服务
- 实现数据查询和更新操作

**数据层（Data Layer）：**
- MySQL数据库存储系统数据
- 实现数据的持久化存储
- 提供数据备份和恢复功能

### 3.1.2 功能架构

```
┌─────────────────────────────────────────────────────────────┐
│                        表现层                                │
├─────────────────────────────────────────────────────────────┤
│  用户界面  │  管理界面  │  数据分析界面  │  移动端适配        │
├─────────────────────────────────────────────────────────────┤
│                        业务逻辑层                            │
├─────────────────────────────────────────────────────────────┤
│ 用户服务 │ 宠物服务 │ 申请服务 │ 分析服务 │ 爬虫服务 │ 安全服务 │
├─────────────────────────────────────────────────────────────┤
│                        数据访问层                            │
├─────────────────────────────────────────────────────────────┤
│ 用户DAO │ 宠物DAO │ 申请DAO │ 品种DAO │ 图片DAO │ 统计DAO │
├─────────────────────────────────────────────────────────────┤
│                        数据层                                │
├─────────────────────────────────────────────────────────────┤
│  MySQL数据库  │  文件存储  │  缓存系统  │  日志系统          │
└─────────────────────────────────────────────────────────────┘
```

### 3.1.3 技术架构

**开发技术栈：**
- 后端框架：Spring Boot 2.7.0
- 数据库：MySQL 8.0
- ORM框架：MyBatis 3.5
- 模板引擎：Thymeleaf 3.0
- 前端框架：Bootstrap 5.3.0
- 图表库：Chart.js 3.9
- 爬虫技术：Jsoup 1.15
- 安全框架：Spring Security

**部署架构：**
- 应用服务器：Tomcat 9.0
- 数据库服务器：MySQL 8.0
- 文件服务器：本地存储
- 缓存服务器：Redis（可选）
- 负载均衡：Nginx（可选）

## 3.2 系统类图设计

### 3.2.1 初步类图设计

```
┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│    User     │    │     Pet     │    │Application  │
├─────────────┤    ├─────────────┤    ├─────────────┤
│ -userId     │    │ -petId      │    │ -appId      │
│ -username   │    │ -name       │    │ -userId     │
│ -password   │    │ -breedId    │    │ -petId      │
│ -email      │    │ -age        │    │ -status     │
│ -role       │    │ -gender     │    │ -reason     │
│ -status     │    │ -status     │    │ -date       │
└─────────────┘    └─────────────┘    └─────────────┘
       │                   │                   │
       └───────────────────┼───────────────────┘
                           │
                   ┌─────────────┐
                   │ PetBreed    │
                   ├─────────────┤
                   │ -breedId    │
                   │ -name       │
                   │ -categoryId │
                   │ -origin     │
                   └─────────────┘
```

### 3.2.2 时序图设计

**用户注册时序图：**
```
用户    │  控制器   │  服务层   │  DAO层   │  数据库
  │        │          │          │          │
  │──注册──→│          │          │          │
  │        │──验证──→│          │          │
  │        │          │──检查──→│          │
  │        │          │          │──查询──→│
  │        │          │          │←──结果──│
  │        │          │←──存在──│          │
  │        │←──错误──│          │          │
  │←──失败──│          │          │          │
```

**宠物信息管理时序图：**
```
管理员  │  控制器   │  服务层   │  DAO层   │  数据库
  │        │          │          │          │
  │──添加──→│          │          │          │
  │        │──验证──→│          │          │
  │        │          │──保存──→│          │
  │        │          │          │──插入──→│
  │        │          │          │←──成功──│
  │        │          │←──成功──│          │
  │        │←──成功──│          │          │
  │←──成功──│          │          │          │
```

### 3.2.3 详细类图设计

```
┌─────────────────────────────────────────────────────────────┐
│                        实体类                                │
├─────────────────────────────────────────────────────────────┤
│  User  │  Pet  │  PetBreed  │  PetCategory  │  Application  │
├─────────────────────────────────────────────────────────────┤
│                        服务类                                │
├─────────────────────────────────────────────────────────────┤
│UserService│PetService│BreedService│AppService│AnalyticsService│
├─────────────────────────────────────────────────────────────┤
│                        控制器类                              │
├─────────────────────────────────────────────────────────────┤
│UserController│PetController│AppController│AnalyticsController│
├─────────────────────────────────────────────────────────────┤
│                        DAO类                                │
├─────────────────────────────────────────────────────────────┤
│  UserDao  │  PetDao  │  BreedDao  │  AppDao  │  AnalyticsDao │
└─────────────────────────────────────────────────────────────┘
```

## 3.3 系统数据库设计

### 3.3.1 数据库实体模型设计

**ER图：**
```
┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│   users     │    │    pets     │    │applications │
│             │    │             │    │             │
│ user_id (PK)│    │ pet_id (PK) │    │app_id (PK)  │
│ username    │    │ name        │    │user_id (FK) │
│ password    │    │ breed_id(FK)│    │pet_id (FK)  │
│ email       │    │ age         │    │status       │
│ role        │    │ gender      │    │reason       │
│ status      │    │ status      │    │date         │
└─────────────┘    └─────────────┘    └─────────────┘
       │                   │                   │
       │                   │                   │
       └───────────────────┼───────────────────┘
                           │
                   ┌─────────────┐
                   │ pet_breeds  │
                   │             │
                   │breed_id (PK)│
                   │name         │
                   │category_id  │
                   │origin       │
                   └─────────────┘
```

**实体属性图：**

**用户实体（User）：**
- 属性：用户ID、用户名、密码、邮箱、电话、地址、角色、状态、创建时间、更新时间
- 主键：用户ID
- 唯一约束：用户名、邮箱

**宠物实体（Pet）：**
- 属性：宠物ID、品种ID、名称、年龄、性别、颜色、体型、健康状况、状态、描述、故事、创建时间、更新时间
- 主键：宠物ID
- 外键：品种ID（关联宠物品种表）

**宠物品种实体（PetBreed）：**
- 属性：品种ID、分类ID、品种名称、原产地、寿命、性格特点、护理难度、描述、创建时间、搜索关键词
- 主键：品种ID
- 外键：分类ID（关联宠物分类表）

**领养申请实体（AdoptionApplication）：**
- 属性：申请ID、用户ID、宠物ID、申请文本、家庭描述、经验、状态、管理员备注、响应日期、创建时间
- 主键：申请ID
- 外键：用户ID（关联用户表）、宠物ID（关联宠物表）

### 3.3.2 数据库设计

**表3-1 用户表（users）**

| 字段名 | 数据类型 | 长度 | 是否为空 | 默认值 | 说明 |
|--------|----------|------|----------|--------|------|
| user_id | INT | - | NOT NULL | AUTO_INCREMENT | 用户ID，主键 |
| username | VARCHAR | 50 | NOT NULL | - | 用户名，唯一 |
| password | VARCHAR | 255 | NOT NULL | - | 密码，加密存储 |
| email | VARCHAR | 100 | NOT NULL | - | 邮箱，唯一 |
| phone | VARCHAR | 20 | NULL | - | 电话号码 |
| address | TEXT | - | NULL | - | 地址 |
| role | ENUM | - | NOT NULL | 'USER' | 用户角色 |
| status | ENUM | - | NOT NULL | 'ACTIVE' | 用户状态 |
| created_at | TIMESTAMP | - | NOT NULL | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | - | NOT NULL | CURRENT_TIMESTAMP | 更新时间 |

**表3-2 宠物表（pets）**

| 字段名 | 数据类型 | 长度 | 是否为空 | 默认值 | 说明 |
|--------|----------|------|----------|--------|------|
| pet_id | INT | - | NOT NULL | AUTO_INCREMENT | 宠物ID，主键 |
| breed_id | INT | - | NULL | - | 品种ID，外键 |
| name | VARCHAR | 100 | NOT NULL | - | 宠物名称 |
| age | INT | - | NULL | - | 年龄（月） |
| gender | ENUM | - | NULL | - | 性别 |
| color | VARCHAR | 50 | NULL | - | 颜色 |
| size | ENUM | - | NULL | - | 体型 |
| health_status | ENUM | - | NOT NULL | 'GOOD' | 健康状况 |
| status | ENUM | - | NOT NULL | 'AVAILABLE' | 状态 |
| description | TEXT | - | NULL | - | 描述 |
| story | TEXT | - | NULL | - | 背景故事 |
| created_at | TIMESTAMP | - | NOT NULL | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | - | NOT NULL | CURRENT_TIMESTAMP | 更新时间 |

**表3-3 宠物品种表（pet_breeds）**

| 字段名 | 数据类型 | 长度 | 是否为空 | 默认值 | 说明 |
|--------|----------|------|----------|--------|------|
| breed_id | INT | - | NOT NULL | AUTO_INCREMENT | 品种ID，主键 |
| category_id | INT | - | NOT NULL | - | 分类ID，外键 |
| breed_name | VARCHAR | 100 | NOT NULL | - | 品种名称 |
| origin | VARCHAR | 100 | NULL | - | 原产地 |
| life_span | VARCHAR | 50 | NULL | - | 寿命 |
| temperament | VARCHAR | 200 | NULL | - | 性格特点 |
| care_level | ENUM | - | NOT NULL | 'MEDIUM' | 护理难度 |
| description | TEXT | - | NULL | - | 品种描述 |
| created_at | TIMESTAMP | - | NOT NULL | CURRENT_TIMESTAMP | 创建时间 |
| search_keywords | TEXT | - | NULL | - | 搜索关键词 |

**表3-4 领养申请表（adoption_applications）**

| 字段名 | 数据类型 | 长度 | 是否为空 | 默认值 | 说明 |
|--------|----------|------|----------|--------|------|
| application_id | INT | - | NOT NULL | AUTO_INCREMENT | 申请ID，主键 |
| user_id | INT | - | NOT NULL | - | 用户ID，外键 |
| pet_id | INT | - | NOT NULL | - | 宠物ID，外键 |
| application_text | TEXT | - | NULL | - | 申请文本 |
| home_description | TEXT | - | NULL | - | 家庭描述 |
| experience | TEXT | - | NULL | - | 经验 |
| status | ENUM | - | NOT NULL | 'PENDING' | 申请状态 |
| admin_notes | TEXT | - | NULL | - | 管理员备注 |
| response_date | TIMESTAMP | - | NULL | - | 响应日期 |
| created_at | TIMESTAMP | - | NOT NULL | CURRENT_TIMESTAMP | 创建时间 |

**表3-5 宠物图片表（pet_images）**

| 字段名 | 数据类型 | 长度 | 是否为空 | 默认值 | 说明 |
|--------|----------|------|----------|--------|------|
| image_id | INT | - | NOT NULL | AUTO_INCREMENT | 图片ID，主键 |
| pet_id | INT | - | NOT NULL | - | 宠物ID，外键 |
| image_url | VARCHAR | 500 | NOT NULL | - | 图片URL |
| is_primary | BOOLEAN | - | NOT NULL | FALSE | 是否主图 |
| display_order | INT | - | NOT NULL | 0 | 显示顺序 |
| created_at | TIMESTAMP | - | NOT NULL | CURRENT_TIMESTAMP | 创建时间 |

## 3.4 本章小结

本章完成了宠物领养系统的概要设计，包括系统架构设计、类图设计和数据库设计。系统采用分层架构，确保各层之间的松耦合和高内聚。通过详细的类图设计，明确了系统的实体关系和数据流向。数据库设计遵循第三范式，确保数据的完整性和一致性。这些设计为后续的系统实现提供了重要的技术指导。 