# 宠物管理分页功能使用说明

## 功能概述

宠物管理模块现在提供了完整的分页功能，包括：

1. **基础分页** - 默认每页显示12条宠物记录
2. **搜索分页** - 搜索结果也支持分页显示
3. **自定义分页** - 可以自定义每页显示数量
4. **分页导航** - 完整的分页导航界面
5. **分页信息** - 显示当前页、总页数、总记录数

## 功能详情

### 1. 基础宠物列表分页
- **访问路径**: `/pets/list?page=1&size=12`
- **默认参数**:
  - `page`: 页码（默认1）
  - `size`: 每页显示数量（默认12）
- **功能**: 显示所有宠物的分页列表
- **排序规则**: 按宠物ID升序排列，第一页显示ID较小的宠物，最后一页显示ID较大的宠物

### 2. 搜索分页功能
- **访问路径**: `/pets/search?keyword=猫&page=1&size=12`
- **支持参数**:
  - `keyword`: 搜索关键词
  - `breedId`: 品种ID
  - `status`: 宠物状态
  - `gender`: 宠物性别
  - `page`: 页码
  - `size`: 每页显示数量

### 3. 分页导航功能
- **最上页**: 跳转到第一页（首页）
- **前一页**: 跳转到上一页
- **当前页**: 显示当前页码
- **下一页**: 跳转到下一页
- **最下页**: 跳转到最后一页（末页）
- **分页信息**: 显示当前页、总页数、总记录数
- **搜索保持**: 在搜索时翻页会保持搜索条件

## 技术实现

### 后端架构

#### 1. Controller层
```java
@GetMapping("/list")
public String listPets(@RequestParam(defaultValue = "1") int page,
                      @RequestParam(defaultValue = "12") int size,
                      Model model) {
    // 分页查询逻辑
}

@GetMapping("/search")
public String searchPets(@RequestParam(required = false) String keyword,
                        // ... 其他参数
                        @RequestParam(defaultValue = "1") int page,
                        @RequestParam(defaultValue = "12") int size,
                        Model model) {
    // 分页搜索逻辑
}
```

#### 2. Service层
```java
// 基础分页查询
List<Pet> getPetsWithPagination(int page, int size);

// 分页搜索查询
List<Pet> searchPetsWithPagination(String keyword, Long breedId, 
                                   String status, String gender, 
                                   int page, int size);

// 获取总记录数
int getFilteredPetsCount(String keyword, Long breedId, 
                        String status, String gender);
```

#### 3. DAO层
```java
// 基础分页查询
List<Pet> getPetsWithPagination(@Param("offset") int offset, 
                                @Param("limit") int limit);

// 分页搜索查询
List<Pet> searchPetsWithPagination(@Param("keyword") String keyword, 
                                   @Param("breedId") Long breedId, 
                                   @Param("status") String status,
                                   @Param("gender") String gender,
                                   @Param("offset") int offset, 
                                   @Param("limit") int limit);
```

#### 4. Mapper层
```xml
<!-- 基础分页查询 -->
<select id="getPetsWithPagination" resultMap="petResultMapWithBreed">
    SELECT ... FROM pets p
    LEFT JOIN pet_breeds pb ON p.breed_id = pb.breed_id
    LEFT JOIN pet_images pi ON p.pet_id = pi.pet_id
    ORDER BY p.pet_id ASC
    LIMIT #{limit} OFFSET #{offset}
</select>

<!-- 分页搜索查询 -->
<select id="searchPetsWithPagination" resultMap="petResultMapWithBreed">
    SELECT ... FROM pets p
    LEFT JOIN pet_breeds pb ON p.breed_id = pb.breed_id
    LEFT JOIN pet_images pi ON p.pet_id = pi.pet_id
    <where>
        <!-- 动态搜索条件 -->
    </where>
    ORDER BY p.pet_id ASC
    LIMIT #{limit} OFFSET #{offset}
</select>
```

### 前端实现

#### 1. 分页导航组件
```html
<!-- 分页导航 -->
<div th:if="${totalPages != null and totalPages > 1}" class="pagination-container">
    <nav aria-label="宠物列表分页">
        <ul class="pagination justify-content-center">
            <!-- 最上页（首页） -->
            <li class="page-item" th:classappend="${currentPage == 1 ? 'disabled' : ''}">
                <a class="page-link" 
                   th:if="${currentPage > 1 and keyword != null}"
                   th:href="@{/pets/search(keyword=${keyword}, breedId=${breedId}, status=${status}, gender=${gender}, page=1, size=${pageSize})}"
                   title="最上页">
                    <i class="fas fa-angle-double-left"></i> 最上页
                </a>
                <!-- 更多分页逻辑 -->
            </li>
            
            <!-- 前一页 -->
            <li class="page-item" th:classappend="${currentPage == 1 ? 'disabled' : ''}">
                <a class="page-link" 
                   th:if="${currentPage > 1 and keyword != null}"
                   th:href="@{/pets/search(keyword=${keyword}, breedId=${breedId}, status=${status}, gender=${gender}, page=${currentPage - 1}, size=${pageSize})}"
                   title="前一页">
                    <i class="fas fa-chevron-left"></i> 前一页
                </a>
                <!-- 更多分页逻辑 -->
            </li>
            
            <!-- 当前页 -->
            <li class="page-item active">
                <span class="page-link" th:text="${currentPage}"></span>
            </li>
            
            <!-- 下一页 -->
            <li class="page-item" th:classappend="${currentPage == totalPages ? 'disabled' : ''}">
                <a class="page-link" 
                   th:if="${currentPage < totalPages and keyword != null}"
                   th:href="@{/pets/search(keyword=${keyword}, breedId=${breedId}, status=${status}, gender=${gender}, page=${currentPage + 1}, size=${pageSize})}"
                   title="下一页">
                    下一页 <i class="fas fa-chevron-right"></i>
                </a>
                <!-- 更多分页逻辑 -->
            </li>
            
            <!-- 最下页（末页） -->
            <li class="page-item" th:classappend="${currentPage == totalPages ? 'disabled' : ''}">
                <a class="page-link" 
                   th:if="${currentPage < totalPages and keyword != null}"
                   th:href="@{/pets/search(keyword=${keyword}, breedId=${breedId}, status=${status}, gender=${gender}, page=${totalPages}, size=${pageSize})}"
                   title="最下页">
                    最下页 <i class="fas fa-angle-double-right"></i>
                </a>
                <!-- 更多分页逻辑 -->
            </li>
        </ul>
    </nav>
    
    <!-- 分页信息 -->
    <div class="text-center mt-2">
        <small class="text-muted">
            显示第 <span th:text="${(currentPage - 1) * pageSize + 1}">1</span> - 
            <span th:text="${currentPage * pageSize > totalCount ? totalCount : currentPage * pageSize}">12</span> 条，
            共 <span th:text="${totalCount}">0</span> 条记录
        </small>
    </div>
</div>
```

#### 2. 分页样式
```css
/* 分页样式 */
.pagination-container {
    margin-top: 30px;
}

.pagination .page-link {
    border: none;
    color: #667eea;
    margin: 0 2px;
    border-radius: 8px;
    transition: all 0.3s ease;
}

.pagination .page-link:hover {
    background-color: #667eea;
    color: white;
    transform: translateY(-1px);
}

.pagination .page-item.active .page-link {
    background: linear-gradient(45deg, #667eea, #764ba2);
    border: none;
}

.pagination .page-item.disabled .page-link {
    color: #6c757d;
    background-color: #f8f9fa;
}
```

## 使用示例

### 1. 基础分页
```
# 查看第1页，每页12条
GET /pets/list?page=1&size=12

# 查看第2页，每页10条
GET /pets/list?page=2&size=10

# 查看第3页，每页20条
GET /pets/list?page=3&size=20
```

### 2. 搜索分页
```
# 搜索"猫"的第1页
GET /pets/search?keyword=猫&page=1&size=12

# 搜索可领养的雄性宠物第2页
GET /pets/search?status=AVAILABLE&gender=MALE&page=2&size=10

# 搜索特定品种的第1页
GET /pets/search?breedId=1&page=1&size=15
```

### 3. 测试接口
```
# 测试基础分页
GET /test/pets/pagination?page=1&size=5

# 测试搜索分页
GET /test/pets/search-pagination?keyword=猫&page=1&size=5

# 测试排序功能
GET /test/pets/sort-test

# 测试分页导航
GET /test/pets/pagination-nav-test
```

## 分页参数说明

### 页码参数 (page)
- **类型**: 整数
- **默认值**: 1
- **范围**: 1 到 总页数
- **说明**: 当前要查看的页码

### 页面大小参数 (size)
- **类型**: 整数
- **默认值**: 12
- **建议范围**: 5-50
- **说明**: 每页显示的记录数量

### 偏移量计算
```java
int offset = (page - 1) * size;
```

### 总页数计算
```java
int totalPages = (int) Math.ceil((double) totalCount / size);
```

## 性能优化

### 1. 数据库优化
- 使用 `LIMIT` 和 `OFFSET` 进行分页
- 在 `ORDER BY` 字段上建立索引
- 避免使用 `COUNT(*)` 进行大量数据统计

### 2. 缓存策略
- 缓存总记录数
- 缓存热门页面的数据
- 使用Redis等缓存中间件

### 3. 前端优化
- 懒加载图片
- 虚拟滚动（大量数据时）
- 分页信息缓存

## 注意事项

1. **性能考虑**: 大量数据时建议使用较小的页面大小
2. **用户体验**: 提供合理的默认页面大小
3. **搜索保持**: 确保搜索条件在翻页时得到保持
4. **边界处理**: 处理页码超出范围的情况
5. **数据一致性**: 确保分页数据的一致性

## 扩展功能

未来可以考虑添加的功能：
1. **无限滚动**: 替代传统分页
2. **虚拟滚动**: 处理大量数据
3. **智能分页**: 根据数据量自动调整页面大小
4. **分页缓存**: 缓存分页结果
5. **导出分页**: 支持导出当前页或所有数据 